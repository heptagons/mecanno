\documentclass[11pt]{article}
\title{\textbf{Horns unit}}
\author{https://github.com/heptagons/meccano/units/horns}
\date{}

\usepackage{../../meccano}
\usepackage{tikz}
\usetikzlibrary{calc}

\begin{document}

\maketitle
\begin{abstract}
Horns unit is a group of seven meccano\meccanoref strips intended to build polygons.
We found the formula to calculate the internal angles then look for polygons and
found hexagons, octagons and dodecagons. We found no pentagons.
\end{abstract}

\begin{figure}[h]
\centering
\begin{tikzpicture}
 \begin{scope}[scale=0.5]
  \draw[black] (0,0)
  -- node[below] {$e$} ++(6,0) node[below] {$B_1$}
  -- node[below,right] {$a$} ++(3,6) node[above] {$C_1$}
  -- node[above] {$b$} ++(-4,-2) node[above] {$A_1$}
  -- node[above] {$d$} ++(-2,-1) node[below] {$E$}
  -- node[above] {$d$} ++(-2,1) node[above] {$A_2$}
  -- node[above] {$b$} ++(-4,2) node[above] {$C_2$}
  -- node[below,left] {$a$} ++(3,-6) node[below] {$B_2$}
  -- cycle;
  \draw[black] (6,0) --++ (-1,4) node[midway,right] {$c$};
  \draw[black] (0,0) --++ (+1,4) node[midway,right] {$c$};

  \draw[blue] (20,0)
  -- node[below,right] {$a$} ++(3,6) node[above] {$C_1$}
  -- node[above] {$f$} ++(-6,-3) node[above] {$E$}
  -- node[above] {$g$} ++(-3,-3) node[below] {$B_2$}
  -- node[below] {$e$} ++(6,0) node[below] {$B_1$}
  -- node[above] {$g$} ++(-3,+3);
  
  \draw[orange] (20,0)+(-1.5,0) 
   arc (180:135:1.5) node[midway,above,left] {$G$}
   arc (135:atan(2):1.5) node[midway,above] {$F$};
 \end{scope}

\end{tikzpicture}
\caption{The \textbf{horn unit} has seven strips: Two of length $a$, two of length $b+d$,
two of length $c$ and one of length $e$.
We expect to build polygons with internal angle $C_1B_1B_2$
and perimeter including segments $a,e,a$.}
\label{fig:horns}
\end{figure}

\section{Algebra}
From figure \ref{fig:horns} we start with triangle $\triangle{A_1B_1C1}$.
At vertex $A_1$ we have angle $A$ and the supplement $A'$:
\begin{align}
A &\equiv \angle{B_1A_1C_1}\\
\cos{A} &= \frac{b^2 + c^2 - a^2}{2bc} &\text{if and only if } a < b+c\\
A' &\equiv \angle{EA_1B_1} = \pi - A\\
\cos{A'} &= \cos{(\pi-A)} = -\cos{A} = \frac{- b^2 - c^2 + a^2}{2bc}
\end{align}

We define $f\equiv b+d$ and $g \equiv \overline{EB_1}$. With the law of cosines we have:
\begin{align}
f &\equiv \boxed{b + d} &\in \bbb{N}\\
g^2 &= c^2 + d^2 - 2cd\cos{A'}\\
 &= c^2 + d^2 - (2cd)\frac{-b^2 - c^2 + a^2}{2bc} \nonumber\\
 &= \frac{bc^2 + bd^2 + b^2d + c^2d - a^2d}{b} \nonumber\\
 &= \frac{(b+d)(bd+c^2) - a^2d }{b}
\end{align}

Define a new variable $h = (b+d)(bd+c^2) - a^2d$:
\begin{align}
h &\equiv \boxed{(bd+c^2)f - a^2d} &\in \bbb{Z}\\
g^2 &= \boxed{\frac{h}{b}}  &\text{if and only if } 0 < h < b
\end{align}


We calculate angles $F \equiv \angle{C_1B1E}$ and $G \equiv \angle{B_2B_1E}$.
We replace $g^2$ by $h/b$:
\begin{align}
\cos{F} &= \frac{a^2 + g^2 - f^2}{2ag} = \frac{a^2b - bf^2 + h}{2abg}\\
\cos{G} &= \boxed{ \frac{e}{2g} }
\end{align}
Define new variable $j = bf^2 - a^2b - h$ so:
\begin{align}
j &\equiv \boxed{bf^2 - a^2b - h} &\in \bbb{Z}\\
\cos{F} &= \frac{a^2b - bf^2 + h}{2abg} = \boxed{\frac{-j}{2abg}}
\end{align}

We calculate cosines squares and products. Again we replace $g^2$ by $h/b$:
\begin{align}
\cos{F}\cos{G} &= \frac{ej}{4abg^2} = \frac{bej}{4abh} = \boxed{\frac{ej}{4ah}} &\in \bbb{Q}\\
\cos^2{F} &= \frac{j^2}{4a^2b^2g^2} = \frac{bj^2}{4a^2b^2h} = \boxed{\frac{j^2}{4a^2bh}} &\in \bbb{Q}\\
\cos^2{G} &= \frac{e^2}{4g^2} = \boxed{\frac{be^2}{4h}} &\in \bbb{Q}\\
\cos^2{F}\cos^2{G} &= \frac{be^2j^2}{16a^2bh^2} = \boxed{\frac{e^2j^2}{16a^2h^2}} &\in \bbb{Q}\\
\end{align}

We calculate the sines part squared and set a common denominator as square $16a^2b^2h^2$:
\begin{align}
(\sin{F}\sin{G})^2 &= (1 - cos^2{F})(1 - cos^2{G})\\
 &= 1 - cos^2{F} - cos^2{G} + cos^2{F}\cos^2{G} \nonumber\\
 &= 1 - \frac{j^2}{4a^2bh} - \frac{be^2}{4h} + \frac{e^2j^2}{16a^2h^2}\nonumber\\
 &= 1 - \frac{j^2}{4a^2bh} - \frac{be^2}{4h} + \frac{e^2j^2}{16a^2h^2}\nonumber\\
 &= \frac{16a^2b^2h^2 -(4bh)j^2 -(4a^2b^2h)be^2 +(b^2)e^2j^2 }{16a^2b^2h^2}\nonumber\\
 &= \frac{16a^2b^2h^2 -4bhj^2 -4a^2b^3e^2h +b^2e^2j^2 }{16a^2b^2h^2}\nonumber\\
 &= \frac{b(be^2-4h)(j^2-4a^2bh)}{16a^2b^2h^2}
\end{align}

Extract square root to get $\sin{F}\sin{G} = \sqrt{D}/A$ where $D,A \in \bbb{Z}$:
\begin{align}
\sin{F}\sin{G} &= \boxed{\frac{\sqrt{b(be^2-4h)(j^2-4a^2bh)}}{4abh}} &\in \bbb{A}
\end{align}

We sum the angles $F$ and $G$ to get:
\begin{align}
\cos{(F+G)} &= \frac{ej}{4ah} - \frac{\sqrt{b(be^2-4h)(j^2-4a^2bh)}}{4abh}\nonumber\\
 &= \frac{bej - \sqrt{b(be^2-4h)(j^2-4a^2bh)}}{4abh} &\in \bbb{A}
\end{align}


\section{Software}
We write a general routine called \texttt{HornsE} to iterate over increasing segments
sizes $e,a,b,c,d$ from $min$ to $max$ and filter cosines of the form $B+C\sqrt{D}/A$:
\begin{lstlisting}
func HornsE(min, max N32, found func(a, b, c, d, e N32), den N32, num ...Z32) {
	factory := NewA32s()
	for e := min; e <= max; e++ {
		for a := min; a <= e; a++ {
			ea := NatGCD(e, a)
			for b := min; b <= e; b++ {
				eab := NatGCD(ea, b)
				for c:= min; c <= max; c++ {
					if a >= b+c || b >= a+c || c >= a+b {
						continue // impossible triangle abc
					}
					eabc := NatGCD(eab, c)
					for d := min; d <= max; d++ {
						if eabcd := NatGCD(eabc, d); eabcd > 1 {
							continue // scaled repetition
						}
						f := b + d
						h := (b*d + c*c)*f - a*a*d
						j := -(a*a*b - b*f*f + h) // non zero for hexagons
						na := 4*N(a)*N(b)*N(h)

						zb := Z(b)*Z(e)*Z(j)
						zd0 := Z(b)
						zd1 := Z(b)*Z(e)*Z(e) - 4*Z(h)
						zd2 := Z(j)*Z(j) - 4*Z(a)*Z(a)*Z(b)*Z(h)
						if zd1 == 0 || zd2 == 0 { // hexagon arcos=1/2
							if cos, err := factory.ANew1(na, zb); err != nil {
								// silent overflow
							} else if cos.Equals(den, num...) {
								found(a, b, c, d, e)
							}
						} else if zd := zd0*zd1*zd2; zd < 0 {
							// skip imaginary numbers
						} else if cos, err := factory.ANew3(na, zb, 1, zd); err != nil {
							// silent overflow
						} else if cos.Equals(den, num...) {
							found(a, b, c, d, e)
						}
					}
				}
			}
		}
	}
}
\end{lstlisting}

\section{Polygons}

\newcommand{\horns}[8]{ % size,factor,a,b,c,d,e,ang
 \begin{tikzpicture}
 \def\a{#3};\def\b{#4};\def\c{#5};\def\d{#6};\def\e{#7};\def\ang{#8}
 \pgfmathsetmacro\f{#4+#6}
 \pgfmathsetmacro\angB{(pow(#3,2) + pow(#5,2) - pow(#4,2))/(2*#3*#5)} % aa+cc-bb/2ac
 \pgfmathsetmacro\angC{(pow(#3,2) + pow(#4,2) - pow(#5,2))/(2*#3*#4)} % aa+bb-cc/2ab
 \begin{scope}
  \meccanostrip[FF0000]{#7}{#1}{#2} %e
 \end{scope}
 \begin{scope}[shift={(#1*#7,0)},rotate=\ang]
  \meccanostrip[FF0000]{#7}{#1}{#2} %a long as e right
  \begin{scope}[rotate=acos(\angB)]
   \meccanostrip[008800]{#5}{#1}{#2} %c
  \end{scope}
  \begin{scope}[shift={(#1*#3,0)},rotate=180-acos(\angC)] % a
   \meccanostrip[0000FF]{\f}{#1}{#2} %b+d=f
  \end{scope}
 \end{scope}
 \begin{scope}[rotate=180-\ang]
  \meccanostrip[F00000]{#7}{#1}{#2} %a long as e left
  \begin{scope}[rotate=-acos(\angB)]
   \meccanostrip[008800]{\c}{#1}{#2} %c
  \end{scope}
  \begin{scope}[shift={(#1*\a,0)},rotate=180+acos(\angC)]
   \meccanostrip[0000FF]{\f}{#1}{#2} %b+d=f
  \end{scope}
 \end{scope}
 \end{tikzpicture}
}

\subsection{Hexagons}
For hexagons we call function \texttt{TestHornsEHexagons} which filters for cosine $1/2$.
We reject later trivial cases where $a=b=c$ that is, an equilateral triangle present:
\begin{lstlisting}
func TestHornsEHexagons(t *testing.T) {
	min, max := N32(0), N32(20)
	fmt.Printf("segments min=%d max=%d a,b,c,d,e:\n", min, max)
	i := 0
	HornsE(min, max, func(a, b, c, d, e N32) {
		// Interesting hexagons are those when abc triangle is not equilateral
		if a != b && a !=c {
			i++
			fmt.Printf("% 3d) %d,%d,%d,%d,%d\n", i, a, b, c, d, e)
		}
	},2,1) //  cos 60Â°
}
\end{lstlisting}

For a range of sizes from $0$ to $20$ we get 16 hexagons, some non trivial:
\begin{lstlisting}
segments min=0 max=20 a,b,c,d,e:
  1) 3,7,5,0,10
  2) 3,8,7,0,13
  3) 10,13,7,0,13
  4) 8,13,7,0,14
  5) 3,8,7,1,15
  6) 5,8,7,2,15
  7) 11,7,7,7,15
  8) 7,13,8,0,16
  9) 3,8,7,2,17
 10) 5,8,7,3,17
 11) 16,14,6,7,17
 12) 8,7,5,7,18
 13) 3,8,7,3,19
 14) 5,8,7,4,19
 15) 7,3,5,11,19
 16) 7,8,5,6,19
--- PASS: TestHornsEHexagons (28.73s)
\end{lstlisting}

\begin{figure}[H]
\centering
\scalebox{0.3}{
 \horns{1}{5pt}{3}{7}{5}{0}{10}{60}
 \horns{1}{5pt}{8}{13}{7}{0}{14}{60}
}
\caption{Trivial hexagons of size 10 and 14. $d=0$.
We call the solutions trivial because contain triangles used by simpler hexagons search.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.3}{
 \horns{1}{5pt}{3}{8}{7}{0}{13}{60}
 \horns{1}{5pt}{10}{13}{7}{0}{13}{60}
}
\caption{Hexagons of size 13. $d=0$. Image at the right is not trivial.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.25}{
 \horns{1}{5pt}{11}{7}{7}{7}{15}{60}
 \horns{1}{5pt}{16}{14}{6}{7}{17}{60}
}
\caption{Non trivial hexagons sizes 15 and 17.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.25}{
 \horns{1}{5pt}{8}{7}{5}{7}{18}{60}
}
\caption{Non trivial hexagon of size 18.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.22}{
 %\horns{1}{5pt}{3}{8}{7}{3}{19}{60}
 %\horns{1}{5pt}{5}{8}{7}{4}{19}{60}
 \horns{1}{5pt}{7}{3}{5}{11}{19}{60}
 \horns{1}{5pt}{7}{8}{5}{6}{19}{60}
}
\caption{Non trivial hexagons of sizes 19.}
\end{figure}


\subsection{Octagons}

For octagons we call function \texttt{TestHornsEOctagons} which filters for
cosine $\sqrt{2}/2$
\begin{lstlisting}
func TestHornsEOctagons(t *testing.T) {
	min, max := N32(1), N32(40)
	fmt.Printf("segments min=%d max=%d a,b,c,d,e:\n", min, max)
	i := 0
	HornsE(min, max, func(a, b, c, d, e N32) {
		i++
		fmt.Printf("% 3d) %d,%d,%d,%d,%d\n", i, a, b, c, d, e)
	},2,0,1,2) //  cos 45 degrees sqrt{2}/2
}
\end{lstlisting}

For a range of segments sizes from $1$ to $40$ we get 10 solutions:
\begin{lstlisting}
segments min=1 max=40 a,b,c,d,e:
  1) 2,3,3,3,8
  2) 3,2,3,7,12
  3) 14,9,9,9,16
  4) 14,11,11,11,24
  5) 21,21,14,6,24
  6) 7,18,17,3,28
  7) 9,10,11,17,36
  8) 9,20,19,7,36
  9) 10,9,11,21,40
 10) 35,27,22,18,40
--- PASS: TestHornsEOctagons (566.86s)
\end{lstlisting}

\setlength{\columnsep}{2pt}
\begin{multicols}{2}

\begin{figure}[H]
\centering
\scalebox{0.4}{ \horns{1}{5pt}{2}{3}{3}{3}{8}{45}}
\caption{Octagon of size 8.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.3}{ \horns{1}{5pt}{3}{2}{3}{7}{12}{45}}
\caption{Octagon of size 12.}
\end{figure}

\end{multicols}

\begin{figure}[H]
\centering
\scalebox{0.3}{\horns{1}{5pt}{14}{9}{9}{9}{16}{45}}
\caption{Octagon of size 16.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.25}{\horns{1}{5pt}{14}{11}{11}{11}{24}{45}}
\scalebox{0.25}{\horns{1}{5pt}{21}{21}{14}{6}{24}{45}}
\caption{Octagons of sizes 24.}
\end{figure}

\subsection{Dodecagons}

For dodecagons we call function \texttt{TestHornsEDodecagons} which filters for
cosine $\sqrt{3}/2$
\begin{lstlisting}
func TestHornsEDodecagons(t *testing.T) {
	min, max := N32(1), N32(40)
	fmt.Printf("segments min=%d max=%d a,b,c,d,e:\n", min, max)
	i := 0
	HornsE(min, max, func(a, b, c, d, e N32) {
		i++
		fmt.Printf("% 3d) %d,%d,%d,%d,%d\n", i, a, b, c, d, e)
	}, 2,0,1,3) //  cos 30 degrees sqrt{3}/2
}
\end{lstlisting}

For a range of segments $1$ to $40$ we found 9 solutions:
\begin{lstlisting}
segments min=1 max=40 a,b,c,d,e:
  1) 6,5,5,5,8
  2) 15,4,13,21,20
  3) 15,9,12,16,20
  4) 15,14,13,11,20
  5) 15,18,15,7,20
  6) 10,13,13,13,24
  7) 21,10,17,25,28
  8) 16,17,17,17,30
  9) 30,11,25,39,40
--- PASS: TestHornsEDodecagons (566.19s)
\end{lstlisting}

\begin{figure}[H]
\centering
\scalebox{0.4}{ \horns{1}{5pt}{6}{5}{5}{5}{8}{30}}
\caption{Dodecagon of size 8.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.25}{ \horns{1}{5pt}{15}{4}{13}{21}{20}{30}}
\caption{Dodecagon of size 20. Special case $d > e$.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.25}{ \horns{1}{5pt}{15}{9}{12}{16}{20}{30}}
\caption{Dodecagon of size 20.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.25}{ \horns{1}{5pt}{15}{14}{13}{11}{20}{30}}
\caption{Dodecagon of size 20.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.25}{ \horns{1}{5pt}{15}{18}{15}{7}{20}{30}}
\caption{Dodecagon of size 20.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.2}{ \horns{1}{5pt}{10}{13}{13}{13}{24}{30}}
\caption{Dodecagon of size 24.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.2}{ \horns{1}{5pt}{21}{10}{17}{25}{28}{30}}
\caption{Dodecagon of size 28.}
\end{figure}

\begin{figure}[H]
\centering
\scalebox{0.2}{ \horns{1}{5pt}{16}{17}{17}{17}{30}{30}}
\caption{Dodecagon of size 30.}
\end{figure}

\section{Algebra simplifications}
If $be^2 = 4h$ then:
\begin{align}
\cos{(F+G)} &= \frac{bej - \sqrt{b(be^2-4h)(j^2-4a^2bh)}}{4abh}\nonumber\\
 &= \frac{bej}{4abh} = \frac{bej}{ab(be^2)} = \frac{j}{abe}\nonumber\\
 &= \frac{bf^2 - a^2b - h}{abe}
\end{align}

\subsection{Simple formula por octagons and dodecagons}
If $j = 0$ then:
\begin{align}
\cos{(F+G)} &= \frac{bej - \sqrt{b(be^2-4h)(j^2-4a^2bh)}}{4abh}\nonumber\\
 &= \frac{-\sqrt{b(be^2-4h)(-4a^2bh)}}{4abh}\nonumber\\
 &= \frac{-2ab\sqrt{(be^2-4h)(-h)}}{4abh}\nonumber\\
 &= \frac{-\sqrt{h(4h-be^2)}}{2h}\\
 j &= 0 \implies h = bf^2 - a^2b
\end{align}
So $\cos{(F+G)}$ is in the form $\sqrt{D}/A$ and we can look for octagons and
dodecagons since they have as cosines $\sqrt{2}/2$ and $\sqrt{3}/2$ respectivelly.




\end{document}
